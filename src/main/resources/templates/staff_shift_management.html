<!-- HTML5 宣言 -->
<!DOCTYPE html>
<!-- ルート要素。日本語、Thymeleaf と Spring Security の名前空間を宣言 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- メタ情報・スタイル -->
<head>
<!-- 文字コード -->
<meta charset="UTF-8">
<!-- ページタイトル -->
<title>スタッフシフト管理 - 予約管理システム</title>
<!-- 共通スタイル -->
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<!-- 本文 -->
<body>
<!-- レイアウトコンテナ -->
<div class="container">
<!-- 見出し -->
<h1>スタッフシフト管理</h1>
<!-- ページ説明 -->
<p>あなたのシフトを管理します。</p>
<!-- 成功メッセージ（?success=shiftUpdated/shiftDeleted） -->
<div th:if= "${param.success}" class="success-message">
<!-- 更新成功 -->
<span th:if= "${param.success == 'shiftUpdated'}">シフトが更新されました。</span>
<!-- 削除成功 -->
<span th:if= "${param.success == 'shiftDeleted'}">シフトが削除されました。</span>
</div>
<!-- 自分のシフト登録/更新フォーム（POST） -->
<h2>シフト登録/更新</h2>
<div th:if="${errorMessage}" class="error-message" style="color: #991b1b; background-color: #fef2f2; padding: 15px; border-radius: 8px; border: 1px solid #fecaca; margin-bottom: 20px;">
    <strong>【入力エラー】</strong>
    <span th:text="${errorMessage}">ここにエラーメッセージが出ます</span>
</div>
<!-- 送信先は /staff/shifts。CSRF hidden を入れるのが実運用では必須 -->
<form th:action="@{/staff/shifts/save}" method="post">
    <!-- 1. hidden は form の直下に置く -->
    <input type="hidden" name="staffId" th:value="${staffId}">

    <!-- 2. 日付：form-group で囲む -->
    <div class="form-group">
        <label for="date">日付:</label>
        <input type="date" id="date" name="date" required>
    </div>

    <!-- 3. 開始時間 -->
    <div class="form-group">
        <label for="startTime">開始時間:</label>
        <input type="time" id="startTime" name="startTime" 
               th:value="${shift != null ? shift.startTime : ''}" required>
    </div>

    <!-- 4. 終了時間 -->
    <div class="form-group">
        <label for="endTime">終了時間:</label>
        <input type="time" id="endTime" name="endTime" 
               th:value="${shift != null ? shift.endTime : ''}" required>
    </div>

    <div class="button-group">
        <button type="submit" class="button">シフト登録/更新</button>
    </div>
</form>
	<!-- 自分のシフト一覧 -->
	<h2>あなたのシフト一覧</h2>
	<!-- シフト一覧テーブル -->
	<table>
	<!-- ヘッダ -->
	<thead>
	<tr>
	<!-- 日付 -->
	<th>日付</th>
	<!-- 開始時間 -->
	<th>開始時間</th>
	<!-- 終了時間 -->
	<th>終了時間</th>
	<!-- 操作 -->
	<th>操作</th>
	</tr>
	</thead>
	<!-- 本体 -->
	<tbody>
	<!-- staffShifts をループ表示 -->
	<tr th:each="shift : ${staffShifts}">
	<!-- 日付（ISO 表示） -->
	<td th:text="${#temporals.format(shift.recordDate, 'yyyy-MM-dd')}"></td>

	<!-- 開始時間 -->
	<td th:text= "${shift.startTime}"></td>
	<!-- 終了時間 -->
	<td th:text= "${shift.endTime}"></td>
	<!-- 行内操作 -->
	<td>
		<!-- 削除実行フォーム（POST）。CSRF hidden を追加するのが安全 -->
		<form th:action="@{/staff/shifts/{id}(id=${shift.id})}" method="post" style="display:inline;">
		<input type="hidden" th:name=
		"${_csrf.parameterName}" th:value=
		"${_csrf.token}">
		
		<!-- 削除ボタン（確認ダイアログ付き） -->
		<button type="submit" class="button danger" onclick="return confirm('本当にこのシフトを削除しますか？');">削除</button>
		</form>
		</td>
		</tr>
		<!-- データが無い場合の代替行 -->
		<tr th:if= "${#lists.isEmpty(staffShifts)}">
		<!-- 4 列分まとめてメッセージ表示 -->
		<td colspan="4">シフトがありません。</td>
		</tr>
		</tbody>
		</table>
		<!-- 下部ナビ -->
		<div class="button-group">
		<!-- ダッシュボードへ戻る -->
		<a th:href="@{/dashboard}" class="button secondary">ダッシュボードに戻る</a>
		</div>
		</div>
		</body>
		</html>