<!-- HTML5 宣言 -->
<!DOCTYPE html>
<!-- ルート要素。日本語、Thymeleaf と Spring Security の名前空間を宣言 -->
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- メタ情報・スタイル -->
<head>
<!-- 文字コード -->
<meta charset="UTF-8">
<!-- ページタイトル -->
<title>スタッフ予約管理 - 予約管理システム</title>
<!-- 共通スタイル -->
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<!-- 本文 -->
<body>
<!-- レイアウトコンテナ -->
<div class="container">
<!-- 見出し -->
<h1>スタッフ予約管理</h1>
<!-- ページ説明 -->
<p>あなたが担当する予約の一覧です。</p>
<!-- 成功メッセージ表示（?success=updated/cancelled） -->
<div th:if=
"${param.success}" class="success-message">
<!-- 更新成功 -->
<span th:if= "${param.success == 'updated'}">予約が更新されました。</span>
<!-- キャンセル成功 -->
<span th:if= "${param.success == 'cancelled'}">予約がキャンセルされました。</span>
</div>
<!-- 予約一覧テーブル -->
<table>
<!-- ヘッダ -->
<thead>
<tr>
<!-- 顧客名 -->
<th>顧客名</th>
<!-- 日付 -->
<th>日付</th>
<!-- 時間 -->
<th>時間</th>
<!-- メニュー -->
<th>メニュー</th>
<!-- ステータス -->
<th>ステータス</th>
<!-- 操作 -->
<th>操作</th>
</tr>
</thead>
<!-- 本体 -->
<tbody>
<!-- staffReservations をループ表示 -->
<tr th:each="reservation : ${staffReservations}">
<!-- 顧客名 -->
<td th:text= "${reservation.user.name}"></td>
<!-- 日付（ISO。必要なら #temporals.format） -->
<td th:text= "${reservation.recordDate}"></td>
<!-- 時間 -->
<td th:text= "${reservation.timeSlot}"></td>
<!-- メニュー -->
<td th:text= "${reservation.menu}"></td>
<!-- ステータス -->
<td th:text= "${reservation.status}"></td>
<!-- 行内操作 -->
<td>
    <!-- 1. 編集ボタン -->
    <a th:href="@{/staff/reservations/{id}/edit(id=${reservation.id})}" class="button secondary">編集</a>

    <!-- 2. キャンセルボタン：ステータスが「予約済」の時だけ表示 -->
	<form th:if="${reservation.status == '予約済' && !reservation.recordDate.isBefore(#temporals.createNow().toLocalDate())}" 
	      th:action="@{/staff/reservations/{id}/cancel(id=${reservation.id})}" 
	      method="post" 
	      onsubmit="return confirm('本当にキャンセルしますか？');" 
	      style="display:inline;">
	    <button type="submit" class="button danger small">キャンセル</button>
	</form>

	<!-- 過去の予約には「終了」などのラベルを出すと親切です -->
	<span th:if="${reservation.recordDate.isBefore(#temporals.createNow().toLocalDate()) && reservation.status == '予約済'}" 
	      class="badge">来店済み</span>

    <!-- 3. キャンセル済の場合の表示 -->
    <span th:if="${reservation.status == 'キャンセル済'}" class="badge danger-text">キャンセル不可</span>
</td> 
<!-- データなし時の代替行 -->
<tr th:if="${#lists.isEmpty(staffReservations)}">
<!-- 6 列分まとめて表示 -->
<td colspan="6">担当する予約がありません。</td>
</tr>
</tbody>
</table>
<!-- 下部ナビ -->
<div class="button-group">
    <!-- クラスのパス設定に合わせて /staff を明示的に指定 -->
    <a th:href="@{/dashboard}" class="button secondary">ダッシュボードに戻る</a>
</div>
</div>
</div>
</body>
</html>